# üßæ –ß–µ–∫-–ª–∏—Å—Ç: `auth` (`http://localhost:8001/api/v1/auth`)

### 1. `/register` (POST)
| –°—Ü–µ–Ω–∞—Ä–∏–π | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç |
|--------|---------------------|
| ‚úÖ –í–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: `second_login`, `phone`, `email`, `password`, `group_names=["customer"]` | –°—Ç–∞—Ç—É—Å `201`, –≤ —Ç–µ–ª–µ `access_token`, `refresh_token` |
| ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `password` | `400` ‚Äî "Password is required" |
| ‚ùå –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π email | `422` (–≤–∞–ª–∏–¥–∞—Ü–∏—è Pydantic) |
| ‚ùå `second_login` < 3 —Å–∏–º–≤–æ–ª–æ–≤ | `422` |
| ‚ùå –ì—Ä—É–ø–ø–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, `group_names=["nonexistent"]`) | `400` ‚Äî "group not found" –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –æ—à–∏–±–∫–∞ –∏–∑ –ë–î |
| ‚ùå –£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º `second_login` | `400` ‚Äî "already exists" |
| ‚ùå –£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç email –∏–ª–∏ phone | `400` ‚Äî "already exists" |

---

### 2. `/login` (POST)
| –°—Ü–µ–Ω–∞—Ä–∏–π | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç |
|--------|---------------------|
| ‚úÖ –í–∞–ª–∏–¥–Ω—ã–π –ª–æ–≥–∏–Ω (`second_login`/`email`/`phone`) + –ø–∞—Ä–æ–ª—å | `200`, —Ç–æ–∫–µ–Ω—ã |
| ‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å | `401` ‚Äî "Invalid credentials" |
| ‚ùå –ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ª–æ–≥–∏–Ω | `401` ‚Äî "Invalid credentials" |
| ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–∞—Ä–æ–ª—å | `400` ‚Äî "Password is required" |

---

### 3. `/refresh` (POST)
| –°—Ü–µ–Ω–∞—Ä–∏–π | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç |
|--------|---------------------|
| ‚úÖ –í–∞–ª–∏–¥–Ω—ã–π `refresh_token` | `200`, –Ω–æ–≤—ã–µ `access_token` –∏ `refresh_token` |
| ‚ùå –ò—Å—Ç—ë–∫—à–∏–π `refresh_token` | `401` ‚Äî "Invalid or expired refresh token" |
| ‚ùå –£–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π `refresh_token` | `401` |
| ‚ùå –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞ | `401` |

---

### 4. `/logout` (POST)
| –°—Ü–µ–Ω–∞—Ä–∏–π | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç |
|--------|---------------------|
| ‚úÖ –í–∞–ª–∏–¥–Ω—ã–π `Authorization: Bearer <access_token>` | `200` ‚Äî `{"detail": "Successfully logged out"}` |
| ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization` | `403` –∏–ª–∏ `401` |
| ‚ùå –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π/–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω | `401` ‚Äî "Invalid or expired token" |
| ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤ `/logout` —Å —Ç–µ–º –∂–µ —Ç–æ–∫–µ–Ω–æ–º | `401` ‚Äî —Ç–æ–∫–µ–Ω —É–∂–µ –≤ —á—ë—Ä–Ω–æ–º —Å–ø–∏—Å–∫–µ |

> üí° –ü–æ—Å–ª–µ logout:  
> - –°—Ç–∞—Ä—ã–π `access_token` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (–ø–æ–ø—Ä–æ–±—É–π –≤—ã–∑–≤–∞—Ç—å `/users/me` ‚Äî –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 401).  
> - –í—Å–µ `refresh`-—Ç–æ–∫–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã.

---

# üßæ –ß–µ–∫-–ª–∏—Å—Ç: `users` (`http://localhost:8002/api/v1/users`)

> ‚ö†Ô∏è –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ endpoint‚Äô—ã —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ `Authorization: Bearer <access_token>`

### 1. `POST /` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
| –°—Ü–µ–Ω–∞—Ä–∏–π | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç |
|--------|---------------------|
| ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ | `201`, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| ‚ùå –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å | `401` |
| ‚ùå –î—É–±–ª—å `second_login` | `400` ‚Äî –æ—à–∏–±–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ |

### 2. `GET /{id}` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
| –°—Ü–µ–Ω–∞—Ä–∏–π | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç |
|--------|---------------------|
| ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å, —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π ID | `200`, –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å, –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π ID | `404` |
| ‚ùå –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å | `401` |

> üí° –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤ –æ—Ç–≤–µ—Ç–µ –µ—Å—Ç—å `groups`, `contacts` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PostgreSQL-—Ñ—É–Ω–∫—Ü–∏—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏).

---

# üßæ –ß–µ–∫-–ª–∏—Å—Ç: `webhook_2can` (`http://localhost:8000/webhook`)

### 1. `POST /` ‚Äî –≤–µ–±—Ö—É–∫ –æ—Ç –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
| –°—Ü–µ–Ω–∞—Ä–∏–π | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç |
|--------|---------------------|
| ‚úÖ –í–∞–ª–∏–¥–Ω—ã–π payload (–≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: `Id`, `MID`, `Amount`, –∏ —Ç.–¥.) | `200`, —Ç–µ–ª–æ = —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ `to_can.process_webhook(...)` |
| ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Id`) | `422` (Pydantic) |
| ‚ùå –í–∞–ª–∏–¥–Ω—ã–π JSON, –Ω–æ –ë–î –æ—Ç–≤–µ—Ä–≥–ª–∞: `{"error": "Invalid MID"}` | `400` ‚Äî "Invalid MID" (–∏–∑ `InvalidWebhookData`) |
| ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î | `503` ‚Äî "Database error" |
| ‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ | `500` ‚Äî "Internal processing error" |

> üí° –û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ:  
> - –í –ª–æ–≥–∞—Ö (`logs/webhook.log`) –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å—å —Å `X-Request-ID`.  
> - –í –æ—Ç–≤–µ—Ç–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-Request-ID`.

---

# üß™ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –∫—Ä–æ—Å—Å-—Å–µ—Ä–≤–∏—Å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

| –°—Ü–µ–Ω–∞—Ä–∏–π | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç |
|--------|---------------------|
| 1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω ‚Üí –≤—ã–∑–≤–∞—Ç—å `/users/me` | –£—Å–ø–µ—à–Ω–æ, –¥–∞–Ω–Ω—ã–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç |
| 2. –ó–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è ‚Üí –≤—ã–∑–≤–∞—Ç—å `/webhook` (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) | –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç |
| 3. –ü–æ—Å–ª–µ `/logout` ‚Üí –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤ `/users/me` | `401` ‚Äî —Ç–æ–∫–µ–Ω –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω |

---

# üìå –ß—Ç–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞ –∑–∞–ø–∏—à–∏:
- ‚úÖ/‚ùå –†–µ–∑—É–ª—å—Ç–∞—Ç
- HTTP-—Å—Ç–∞—Ç—É—Å
- –¢–µ–ª–æ –æ—Ç–≤–µ—Ç–∞ (—É—Å–ø–µ—à–Ω–æ–≥–æ/–æ—à–∏–±–æ—á–Ω–æ–≥–æ)
- –ó–∞–≥–æ–ª–æ–≤–∫–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ `X-Request-ID`)
- –ó–∞–ø–∏—Å—å –≤ –ª–æ–≥–∞—Ö (—É—Ä–æ–≤–µ–Ω—å, —Å–æ–æ–±—â–µ–Ω–∏–µ)
